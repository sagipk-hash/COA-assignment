`timescale 1ns / 1ps



// TESTBENCH

module tb_array_multiplier_16bit;

    // Inputs
    reg  [15:0] tb_A;
    reg  [15:0] tb_B;

    // Outputs
    wire [31:0] tb_P;

    // Internal testbench variables
    integer     error_count;
    integer     i;
    wire [31:0] expected_P;

    // Instantiate the Device Under Test (DUT)
    array_multiplier_16bit DUT (
        .A(tb_A),
        .B(tb_B),
        .P(tb_P)
    );

    // Create a "golden reference" model using Verilog's built-in multiplier
    // This is what we will check our DUT against
    assign expected_P = tb_A * tb_B;

    // Task to apply inputs and check the result
    task check_multiplication;
        input [15:0] a_in;
        input [15:0] b_in;
        begin
            tb_A = a_in;
            tb_B = b_in;

            // Wait for combinational logic to settle
            #10; 

            // Check for correctness (use !== to check for X/Z states)
            if (tb_P !== expected_P) begin
                $display("ERROR: %h * %h = %h (DUT) -- Expected: %h", 
                         tb_A, tb_B, tb_P, expected_P);
                error_count = error_count + 1;
            end else begin
                $display("PASS: %h * %h = %h", tb_A, tb_B, tb_P);
            end
        end
    endtask

    // Main test sequence
    initial begin
        $display("--- Starting 16-bit Multiplier Testbench ---");
        error_count = 0;

        // --- 1. Run 20 Random Test Cases ---
        $display("--- Testing 20 Random Multiplications ---");
        for (i = 0; i < 20; i = i + 1) begin
            check_multiplication($random, $random);
        end

        // --- 2. Run Edge Cases ---
        $display("--- Testing Edge Cases ---");
        check_multiplication(16'h0000, 16'h0000); // Zero * Zero
        check_multiplication(16'h1234, 16'h0000); // Num * Zero
        check_multiplication(16'h0000, 16'hABCD); // Zero * Num
        check_multiplication(16'h0001, 16'h0001); // 1 * 1
        check_multiplication(16'h0002, 16'h0003); // Small nums
        check_multiplication(16'hFFFF, 16'h0001); // Max * 1
        check_multiplication(16'h0001, 16'hFFFF); // 1 * Max
        check_multiplication(16'hAAAA, 16'h5555); // Pattern test
        check_multiplication(16'hFFFF, 16'hFFFF); // Max * Max (Overflow test)

        // --- 3. Final Summary ---
        #20; // Wait for final check
        $display("--- Test Complete ---");
        if (error_count == 0) begin
            $display("All %0d tests passed! ðŸ†", (20 + 9));
        end else begin
            $display("%0d errors found! âŒ", error_count);
        end

        $finish;
    end

endmodule
